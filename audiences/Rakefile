#!/usr/bin/env rake

# frozen_string_literal: true

require "logger"
require "bundler/setup"
require "bundler/gem_tasks"

require "rspec/core/rake_task"
RSpec::Core::RakeTask.new(spec: %w[app:db:prepare])

require "rubocop/rake_task"
RuboCop::RakeTask.new(:rubocop)

APP_RAKEFILE = File.expand_path("spec/dummy/Rakefile", __dir__)
load "rails/tasks/engine.rake"
load "rails/tasks/statistics.rake"

desc "Build audiences-react and bundle JavaScript"
task build_frontend: :environment do
  puts "Building audiences-react first..."
  system("cd ../audiences-react && yarn install && yarn build") || raise("Failed to build audiences-react")

  puts "Frontend build complete. The gem can now be packaged separately when needed."
end

task default: %i[rubocop spec build_frontend]
